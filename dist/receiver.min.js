var $jscomp={scope:{},owns:function(a,b){return Object.prototype.hasOwnProperty.call(a,b)}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,d,c){if(b){d=$jscomp.global;a=a.split(".");for(c=0;c<a.length-1;c++){var f=a[c];f in d||(d[f]={});d=d[f]}a=a[a.length-1];c=d[a];b=b(c);b!=c&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Object.assign",function(a){return a?a:function(a,d){for(var c=1;c<arguments.length;c++){var b=arguments[c];if(b)for(var e in b)$jscomp.owns(b,e)&&(a[e]=b[e])}return a}},"es6-impl","es3");
var $=function(a){return document.querySelector(a)},$$=function(a){return document.querySelectorAll(a)},Receiver=function(a,b){function d(a,b){c=io.connect();e=new RTCPeerConnection(h,k);c.on("your-id",function(b){f=b;c.emit("logon",{from:f,to:a})});c.on("image-data",function(a){g.waveform=a.waveform;g.cover=a.cover});e.addEventListener("icecandidate",function(b){c.emit("message",{from:f,to:a,data:{type:"candidate",candidate:b.candidate}})});e.addEventListener("addstream",function(a){b(a.stream)});
c.on("message",function(b){"candidate"===b.data.type?b.data.candidate&&e.addIceCandidate(new RTCIceCandidate(b.data.candidate)):"sdp"===b.data.type&&e.setRemoteDescription(new RTCSessionDescription(b.data.sdp),function(){e.createAnswer(function(b){e.setLocalDescription(b);c.emit("message",{from:f,to:a,data:{type:"sdp",sdp:b}})},function(a){console.error("Failure callback from createAnswer:");console.error(JSON.stringify(a))})},function(a){console.error("Failure callback from setRemoteDescription:");
console.error(JSON.stringify(a))})});window.addEventListener("beforeunload",function(){c.emit("logoff",{to:a,from:f})});e.createDataChannel("mediaDescription").onmessage=function(a){Object.assign(g,JSON.parse(a.data))}}var c,f,e,g={},h={iceServers:[{url:"stun:stun.l.google.com:19302"}]},k={optional:[{RtpDataChannels:!0}]};d.prototype.getMediaDescription=function(){return g};return d}(),ReceiverChat=function(a,b){function d(a,b){e=b;f=a}var c=io.connect(),f,e;d.prototype.sendMessage=function(a){console.debug(f,
e,a);c.emit("chat",{station:f,from:e,message:a})};d.prototype.onMessage=function(a){c.on("chat",function(b){a(b)})};return d}(),receiver,duration,chat,currentTime;function getStation(){return document.location.hash.split("#!/")[1]||null}
function renderMetadata(a){duration=a.duration;currentTime=a.currentTime;$("#title").innerHTML=a.title;$("#artist").innerHTML=a.artist;$("#waveform").src=a.waveform;$("#cover").src=a.cover;for(var b=$$(".background"),d=0;d<b.length;d++)b[d].style.backgroundImage='url("'+a.cover+'")'}function registerChatHandler(){$("#send-message").addEventListener("click",function(){chat.sendMessage($("#message").value)})}
function timeUpdate(){(function b(){requestAnimationFrame(b);currentTime=Math.abs(receiver.getMediaDescription().startTime-Date.now())/1E3-$("audio").currentTime;$("#playbar").style.transform="translateX("+currentTime/duration*100+"%)"})()}
window.onload=function(){var a=getStation();a?(receiver=new Receiver(a,function(a){document.querySelector("audio").src=URL.createObjectURL(a);renderMetadata(receiver.getMediaDescription());timeUpdate()}),console.debug("Creating chat instance for station "+a),chat=new ReceiverChat(a,"Jeremy"),registerChatHandler(),chat.onMessage(function(a){var b=document.createElement("div");b.classList.add("message");var c=document.createElement("span");c.innerHTML=a.from;c.classList.add("from");b.appendChild(c);
c=document.createElement("p");c.innerHTML=a.message;b.appendChild(c);$("#messages").appendChild(b);console.log(a)})):alert("No station entered")};