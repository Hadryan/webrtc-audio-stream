var $jscomp={scope:{},owns:function(a,b){return Object.prototype.hasOwnProperty.call(a,b)}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in c||(c[e]={});c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Object.assign",function(a){return a?a:function(a,c){for(var b=1;b<arguments.length;b++){var e=arguments[b];if(e)for(var f in e)$jscomp.owns(e,f)&&(a[f]=e[f])}return a}},"es6-impl","es3");
var module$src$js$receiver_concat={},$$$module$src$js$receiver_concat=function(a){return document.querySelector(a)},$$$$module$src$js$receiver_concat=function(a){return document.querySelectorAll(a)},$jscompDefaultExport$$module$src$js$receiver_concat={$:$$$module$src$js$receiver_concat,$$:$$$$module$src$js$receiver_concat},Receiver$$module$src$js$receiver_concat=function(a,b){var c=this,d=io.connect();window.addEventListener("beforeunload",function(){d.emit("logoff",{to:a,from:c.client})});Object.assign(this,
{station:a,callback:b,socket:d,mediaDescription:{}});this.registerSocketEvents();this.createPeer()};
Receiver$$module$src$js$receiver_concat.prototype.registerSocketEvents=function(){var a=this,b=this.socket;b.on("your-id",function(c){a.client=c;b.emit("logon",{from:a.client,to:a.station})});b.on("image-data",function(b){a.mediaDescription.waveform=b.waveform;a.mediaDescription.cover=b.cover});b.on("message",function(c){var d=a.peer;"candidate"===c.data.type?c.data.candidate&&d.addIceCandidate(new RTCIceCandidate(c.data.candidate)):"sdp"===c.data.type&&d.setRemoteDescription(new RTCSessionDescription(c.data.sdp),
function(){d.createAnswer(function(c){d.setLocalDescription(c);b.emit("message",{from:a.client,to:a.station,data:{type:"sdp",sdp:c}})},function(a){console.error("Failure callback from createAnswer:");console.error(JSON.stringify(a))})},function(a){console.error("Failure callback from setRemoteDescription:");console.error(JSON.stringify(a))})})};Receiver$$module$src$js$receiver_concat.prototype.getRtcConfigAndOptions=function(){return{rtcConfig:{iceServers:[{url:"stun:stun.l.google.com:19302"}]},rtcOptionals:{optional:[{RtpDataChannels:!0}]}}};
Receiver$$module$src$js$receiver_concat.prototype.createPeer=function(){var a=this,b=this.getRtcConfigAndOptions(),c=this.socket;this.peer=new RTCPeerConnection(b.rtcConfig,b.rtcOptionals);this.peer.addEventListener("icecandidate",function(b){c.emit("message",{from:a.client,to:a.station,data:{type:"candidate",candidate:b.candidate}})});this.peer.addEventListener("addstream",function(b){a.callback({streamUrl:b.stream})});this.peer.createDataChannel("mediaDescription").onmessage=function(a){Object.assign(this.mediaDescription,
JSON.parse(a.data))}};Receiver$$module$src$js$receiver_concat.prototype.getMediaDescription=function(){return this.mediaDescription};var ReceiverChat$$module$src$js$receiver_concat=function(a,b){var c=io.connect();Object.assign(this,{id:b,station:a,socket:c})};ReceiverChat$$module$src$js$receiver_concat.prototype.sendMessage=function(a){this.socket.emit("chat",{station:this.station,from:this.id,message:a})};
ReceiverChat$$module$src$js$receiver_concat.prototype.onMessage=function(a){this.socket.on("chat",function(b){a(b)})};var receiver$$module$src$js$receiver_concat,duration$$module$src$js$receiver_concat,chat$$module$src$js$receiver_concat,currentTime$$module$src$js$receiver_concat;function getStation$$module$src$js$receiver_concat(){return document.location.hash.split("#!/")[1]||null}
function renderMetadata$$module$src$js$receiver_concat(a){duration$$module$src$js$receiver_concat=a.duration;currentTime$$module$src$js$receiver_concat=a.currentTime;$$$module$src$js$receiver_concat("#title").innerHTML=a.title;$$$module$src$js$receiver_concat("#artist").innerHTML=a.artist;$$$module$src$js$receiver_concat("#waveform").src=a.waveform;$$$module$src$js$receiver_concat("#cover").src=a.cover;for(var b=$$$$module$src$js$receiver_concat(".background"),c=0;c<b.length;c++)b[c].style.backgroundImage=
'url("'+a.cover+'")'}function registerChatHandler$$module$src$js$receiver_concat(){$$$module$src$js$receiver_concat("#send-message").addEventListener("click",function(){chat$$module$src$js$receiver_concat.sendMessage($$$module$src$js$receiver_concat("#message").value)})}
function timeUpdate$$module$src$js$receiver_concat(){(function b(){requestAnimationFrame(b);currentTime$$module$src$js$receiver_concat=Math.abs(receiver$$module$src$js$receiver_concat.getMediaDescription().startTime-Date.now())/1E3-$$$module$src$js$receiver_concat("audio").currentTime;$$$module$src$js$receiver_concat("#playbar").style.transform="translateX("+currentTime$$module$src$js$receiver_concat/duration$$module$src$js$receiver_concat*100+"%)"})()}
window.onload=function(){var a=getStation$$module$src$js$receiver_concat();a?(receiver$$module$src$js$receiver_concat=new Receiver$$module$src$js$receiver_concat(a,function(a){a=a.streamUrl;document.querySelector("audio").src=URL.createObjectURL(a);renderMetadata$$module$src$js$receiver_concat(receiver$$module$src$js$receiver_concat.getMediaDescription());timeUpdate$$module$src$js$receiver_concat()}),console.debug("Creating chat instance for station "+a),chat$$module$src$js$receiver_concat=new ReceiverChat$$module$src$js$receiver_concat(a,
"Jeremy"),registerChatHandler$$module$src$js$receiver_concat(),chat$$module$src$js$receiver_concat.onMessage(function(a){var b=document.createElement("div");b.classList.add("message");var d=document.createElement("span");d.innerHTML=a.from;d.classList.add("from");b.appendChild(d);d=document.createElement("p");d.innerHTML=a.message;b.appendChild(d);$$$module$src$js$receiver_concat("#messages").appendChild(b);console.log(a)})):console.error("No station entered")};
module$src$js$receiver_concat.default=$jscompDefaultExport$$module$src$js$receiver_concat;module$src$js$receiver_concat.Receiver=Receiver$$module$src$js$receiver_concat;module$src$js$receiver_concat.ReceiverChat=ReceiverChat$$module$src$js$receiver_concat;